<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>水利南部差勤系統</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
    }
    
    main {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .header {
      background: linear-gradient(135deg, #2a74ff, #1a5ce6);
      color: white;
      padding: 15px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    
    
    .iframe-container {
      flex: 1;
      padding: 10px;
      background-color: #f5f7fa;
      position: relative;
    }
    
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      background-color: white;
    }
    
    .loading-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      text-align: center;
      z-index: 1000;
    }
    
    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #2a74ff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error-message {
      background: #ffe6e6;
      color: #d63384;
      padding: 15px;
      margin: 10px;
      border-radius: 5px;
      border-left: 4px solid #d63384;
      display: none;
    }
    
    .controls {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 1001;
    }
    
    .btn {
      background: #2a74ff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(42, 116, 255, 0.3);
    }
    
    .btn:hover {
      background: #1a5ce6;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(42, 116, 255, 0.4);
    }
    
    /* 響應式設計 */
    @media (max-width: 768px) {
      .header h3 {
        font-size: 1.2em;
      }
      
      .iframe-container {
        padding: 5px;
      }
      
      .controls {
        bottom: 10px;
        right: 10px;
      }
      
      .btn {
        padding: 8px 12px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <main>
    <header class="header">

    </header>
    
    <div class="error-message" id="errorMessage">
      系統載入失敗，請檢查網路連線或稍後再試。
      <button onclick="reloadSystem()" style="margin-left: 10px; padding: 5px 10px;">重新載入</button>
    </div>
    
    <div class="iframe-container">
      <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p>系統載入中，請稍候...</p>
      </div>
      
      <iframe 
        id="systemFrame" 
        src="https://script.google.com/macros/s/AKfycbwR6sw0HDYsP7_qsa0SZohSsuQWOUbqzy9jDANw2Tptuif8IaSZu7--WCKdKQNusVX9fQ/exec" 
        frameborder="0"
        allow="clipboard-read; clipboard-write"
        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals">
      </iframe>
    </div>
    
    <div class="controls">
      <button class="btn" onclick="toggleFullscreen()" title="全螢幕顯示">
        📺 全螢幕
      </button>
      <button class="btn" onclick="reloadSystem()" title="重新載入系統">
        🔄 重新整理
      </button>
    </div>
  </main>

  <script>
    // 系統載入狀態管理
    let systemLoaded = false;
    let loadTimeout;
    
    // 頁面載入完成後初始化
    window.addEventListener('load', function() {
      initializeSystem();
    });
    
    function initializeSystem() {
      const iframe = document.getElementById('systemFrame');
      const loadingOverlay = document.getElementById('loadingOverlay');
      const errorMessage = document.getElementById('errorMessage');
      
      // 設定載入超時 (15秒)
      loadTimeout = setTimeout(function() {
        if (!systemLoaded) {
          showError('系統載入超時，請檢查網路連線');
        }
      }, 15000);
      
      // iframe 載入完成事件
      iframe.onload = function() {
        systemLoaded = true;
        clearTimeout(loadTimeout);
        
        // 延遲隱藏載入畫面，讓使用者看到載入完成
        setTimeout(function() {
          loadingOverlay.style.display = 'none';
        }, 500);
        
        console.log('差勤系統載入完成');
      };
      
      // iframe 載入錯誤事件
      iframe.onerror = function() {
        showError('系統載入失敗');
      };
    }
    
    function showError(message) {
      const loadingOverlay = document.getElementById('loadingOverlay');
      const errorMessage = document.getElementById('errorMessage');
      
      loadingOverlay.style.display = 'none';
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      
      console.error('差勤系統錯誤:', message);
    }
    
    function reloadSystem() {
      const iframe = document.getElementById('systemFrame');
      const loadingOverlay = document.getElementById('loadingOverlay');
      const errorMessage = document.getElementById('errorMessage');
      
      // 重置狀態
      systemLoaded = false;
      errorMessage.style.display = 'none';
      loadingOverlay.style.display = 'block';
      
      // 重新載入 iframe
      iframe.src = iframe.src;
      
      // 重新初始化
      initializeSystem();
      
      console.log('重新載入差勤系統');
    }
    
    function toggleFullscreen() {
      const iframe = document.getElementById('systemFrame');
      
      if (!document.fullscreenElement) {
        // 進入全螢幕
        if (iframe.requestFullscreen) {
          iframe.requestFullscreen();
        } else if (iframe.webkitRequestFullscreen) {
          iframe.webkitRequestFullscreen();
        } else if (iframe.msRequestFullscreen) {
          iframe.msRequestFullscreen();
        }
      } else {
        // 退出全螢幕
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      }
    }
    
    // 監聽全螢幕狀態變化
    document.addEventListener('fullscreenchange', function() {
      const btn = document.querySelector('.controls button');
      if (document.fullscreenElement) {
        btn.innerHTML = '📱 退出全螢幕';
      } else {
        btn.innerHTML = '📺 全螢幕';
      }
    });
    
    // 錯誤處理：捕獲未處理的錯誤
    window.addEventListener('error', function(e) {
      console.error('頁面錯誤:', e.error);
      showError('頁面發生錯誤，請重新載入');
    });
    
    // 網路狀態監聽
    window.addEventListener('online', function() {
      console.log('網路連線已恢復');
      if (!systemLoaded) {
        reloadSystem();
      }
    });
    
    window.addEventListener('offline', function() {
      console.log('網路連線中斷');
      showError('網路連線中斷，請檢查網路設定');
    });
  </script>
</body>
</html>
