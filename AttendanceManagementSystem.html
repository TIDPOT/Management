<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ°´åˆ©å—éƒ¨å·®å‹¤ç³»çµ±</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
    }
    
    main {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .header {
      background: linear-gradient(135deg, #2a74ff, #1a5ce6);
      color: white;
      padding: 15px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    
    
    .iframe-container {
      flex: 1;
      padding: 10px;
      background-color: #f5f7fa;
      position: relative;
    }
    
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      background-color: white;
    }
    
    .loading-overlay {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      text-align: center;
      z-index: 1000;
    }
    
    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #2a74ff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error-message {
      background: #ffe6e6;
      color: #d63384;
      padding: 15px;
      margin: 10px;
      border-radius: 5px;
      border-left: 4px solid #d63384;
      display: none;
    }
    
    .controls {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 1001;
    }
    
    .btn {
      background: #2a74ff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(42, 116, 255, 0.3);
    }
    
    .btn:hover {
      background: #1a5ce6;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(42, 116, 255, 0.4);
    }
    
    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 768px) {
      .header h3 {
        font-size: 1.2em;
      }
      
      .iframe-container {
        padding: 5px;
      }
      
      .controls {
        bottom: 10px;
        right: 10px;
      }
      
      .btn {
        padding: 8px 12px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <main>
    <header class="header">

    </header>
    
    <div class="error-message" id="errorMessage">
      ç³»çµ±è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚
      <button onclick="reloadSystem()" style="margin-left: 10px; padding: 5px 10px;">é‡æ–°è¼‰å…¥</button>
    </div>
    
    <div class="iframe-container">
      <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p>ç³»çµ±è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...</p>
      </div>
      
      <iframe 
        id="systemFrame" 
        src="https://script.google.com/macros/s/AKfycbwR6sw0HDYsP7_qsa0SZohSsuQWOUbqzy9jDANw2Tptuif8IaSZu7--WCKdKQNusVX9fQ/exec" 
        frameborder="0"
        allow="clipboard-read; clipboard-write"
        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals">
      </iframe>
    </div>
    
    <div class="controls">
      <button class="btn" onclick="toggleFullscreen()" title="å…¨è¢å¹•é¡¯ç¤º">
        ğŸ“º å…¨è¢å¹•
      </button>
      <button class="btn" onclick="reloadSystem()" title="é‡æ–°è¼‰å…¥ç³»çµ±">
        ğŸ”„ é‡æ–°æ•´ç†
      </button>
    </div>
  </main>

  <script>
    // ç³»çµ±è¼‰å…¥ç‹€æ…‹ç®¡ç†
    let systemLoaded = false;
    let loadTimeout;
    
    // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
    window.addEventListener('load', function() {
      initializeSystem();
    });
    
    function initializeSystem() {
      const iframe = document.getElementById('systemFrame');
      const loadingOverlay = document.getElementById('loadingOverlay');
      const errorMessage = document.getElementById('errorMessage');
      
      // è¨­å®šè¼‰å…¥è¶…æ™‚ (15ç§’)
      loadTimeout = setTimeout(function() {
        if (!systemLoaded) {
          showError('ç³»çµ±è¼‰å…¥è¶…æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š');
        }
      }, 15000);
      
      // iframe è¼‰å…¥å®Œæˆäº‹ä»¶
      iframe.onload = function() {
        systemLoaded = true;
        clearTimeout(loadTimeout);
        
        // å»¶é²éš±è—è¼‰å…¥ç•«é¢ï¼Œè®“ä½¿ç”¨è€…çœ‹åˆ°è¼‰å…¥å®Œæˆ
        setTimeout(function() {
          loadingOverlay.style.display = 'none';
        }, 500);
        
        console.log('å·®å‹¤ç³»çµ±è¼‰å…¥å®Œæˆ');
      };
      
      // iframe è¼‰å…¥éŒ¯èª¤äº‹ä»¶
      iframe.onerror = function() {
        showError('ç³»çµ±è¼‰å…¥å¤±æ•—');
      };
    }
    
    function showError(message) {
      const loadingOverlay = document.getElementById('loadingOverlay');
      const errorMessage = document.getElementById('errorMessage');
      
      loadingOverlay.style.display = 'none';
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      
      console.error('å·®å‹¤ç³»çµ±éŒ¯èª¤:', message);
    }
    
    function reloadSystem() {
      const iframe = document.getElementById('systemFrame');
      const loadingOverlay = document.getElementById('loadingOverlay');
      const errorMessage = document.getElementById('errorMessage');
      
      // é‡ç½®ç‹€æ…‹
      systemLoaded = false;
      errorMessage.style.display = 'none';
      loadingOverlay.style.display = 'block';
      
      // é‡æ–°è¼‰å…¥ iframe
      iframe.src = iframe.src;
      
      // é‡æ–°åˆå§‹åŒ–
      initializeSystem();
      
      console.log('é‡æ–°è¼‰å…¥å·®å‹¤ç³»çµ±');
    }
    
    function toggleFullscreen() {
      const iframe = document.getElementById('systemFrame');
      
      if (!document.fullscreenElement) {
        // é€²å…¥å…¨è¢å¹•
        if (iframe.requestFullscreen) {
          iframe.requestFullscreen();
        } else if (iframe.webkitRequestFullscreen) {
          iframe.webkitRequestFullscreen();
        } else if (iframe.msRequestFullscreen) {
          iframe.msRequestFullscreen();
        }
      } else {
        // é€€å‡ºå…¨è¢å¹•
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      }
    }
    
    // ç›£è½å…¨è¢å¹•ç‹€æ…‹è®ŠåŒ–
    document.addEventListener('fullscreenchange', function() {
      const btn = document.querySelector('.controls button');
      if (document.fullscreenElement) {
        btn.innerHTML = 'ğŸ“± é€€å‡ºå…¨è¢å¹•';
      } else {
        btn.innerHTML = 'ğŸ“º å…¨è¢å¹•';
      }
    });
    
    // éŒ¯èª¤è™•ç†ï¼šæ•ç²æœªè™•ç†çš„éŒ¯èª¤
    window.addEventListener('error', function(e) {
      console.error('é é¢éŒ¯èª¤:', e.error);
      showError('é é¢ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹é‡æ–°è¼‰å…¥');
    });
    
    // ç¶²è·¯ç‹€æ…‹ç›£è½
    window.addEventListener('online', function() {
      console.log('ç¶²è·¯é€£ç·šå·²æ¢å¾©');
      if (!systemLoaded) {
        reloadSystem();
      }
    });
    
    window.addEventListener('offline', function() {
      console.log('ç¶²è·¯é€£ç·šä¸­æ–·');
      showError('ç¶²è·¯é€£ç·šä¸­æ–·ï¼Œè«‹æª¢æŸ¥ç¶²è·¯è¨­å®š');
    });
  </script>
</body>
</html>
